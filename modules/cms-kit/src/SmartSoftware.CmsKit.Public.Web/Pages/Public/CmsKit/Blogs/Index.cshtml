@page

@using SmartSoftware.CmsKit.Public.Web.Pages
@using SmartSoftware.CmsKit.Public.Web.Pages.Public.CmsKit.Blogs
@using SmartSoftware.CmsKit.Web

@inherits CmsKitPublicPageBase

@model IndexModel

@section styles {
    <ss-style src="/Pages/Public/CmsKit/Blogs/index.css" />
}

@section scripts {
    <ss-script-bundle>
        <ss-script src="/Pages/Public/CmsKit/Blogs/index.js" />
    </ss-script-bundle>
}

@{
    const string dummyImageSource = "/cms-kit/dummy-placeholder-320x180.png";
}

@if (Model.AuthorId.HasValue)
{
    <ss-row id="blogs-filter-area">
        <ss-column size="_4">
            <div class="mb-3">
                <label class="form-label" asp-for="@Model.SelectedAuthor"></label>

                <select id="AuthorSelect" asp-for="@Model.AuthorId"
                        class="auto-complete-select"
                        data-placeholder="@L["SelectAnAuthor"]"
                        data-allow-clear="true"
                        data-autocomplete-api-url="/api/cms-kit-public/blog-posts/authors"
                        data-autocomplete-display-property="userName"
                        data-autocomplete-value-property="id"
                        data-autocomplete-items-property="items"
                        data-autocomplete-filter-param-name="filter">

                    @if (Model.SelectedAuthor != null)
                    {
                        <option selected value="@Model.AuthorId" selected="selected">@Model.SelectedAuthor.UserName</option>
                    }
                </select>
            </div>
        </ss-column>
    </ss-row>
    <hr />
}

@if (Model.TagId.HasValue)
{
    <h4>@L["Tags"]</h4>
        <span class="badge rounded-pill badge-secondary text-bg-secondary">@Model.FilteredTagName
            <a href="/@CmsBlogsWebConsts.BlogsRoutePrefix/@Model.BlogSlug" class="text-bg-secondary"><i class="fa fa-close ms-1"></i></a>
        </span>
    <hr />
}

@if (Model.Blogs.TotalCount > 0)
{
    <ss-row id="blogs-container">
        @foreach (var blog in Model.Blogs.Items)
        {
            <ss-column size="_12" size-md="_6" size-lg="_4">
                <ss-card>
                    @if (blog.CoverImageMediaId != null)
                    {
                        <img src="/api/cms-kit/media/@blog.CoverImageMediaId" class="card-img-top" onerror="this.src='@dummyImageSource'" />
                    }
                    else
                    {
                        <img src="@(dummyImageSource)?text=@blog.Title" class="card-img-top" />
                    }
                    <ss-card-body class="p-4">
                        <h5>@blog.Title</h5>
                        <p class="mb-2">
                            <span class="font-weight-bold author-name-span" data-author-id="@blog.Author.Id">@@@blog.Author?.UserName</span>
                            <small style="opacity:.65;">@blog.CreationTime</small>
                        </p>
                        <p style="min-height: 60px;">@blog.ShortDescription</p>
                        <div class="d-grid gap-2">
                            <a href="/@CmsBlogsWebConsts.BlogsRoutePrefix/@Model.BlogSlug/@blog.Slug" class="btn btn-light">
                                @L["Read"]
                            </a>
                        </div>
                    </ss-card-body>
                </ss-card>
            </ss-column>
        }
    </ss-row>
    <ss-row>
        <ss-column>
            <ss-paginator model="Model.PagerModel" />
        </ss-column>
    </ss-row>
}
else
{
    <div class="w-100 h-100 d-flex flex-column align-items-center justify-content-center py-5">
        <h1><i class="fa fa-ban"></i></h1>
        <h3>@L["NoBlogPostYet"]</h3>
    </div>
}
